<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>üèÉ Mikhail Play</title>

<style>
body {
  background:#222;
  color:white;
  font-family:Arial;
  text-align:center;
}

canvas {
  border:2px solid white;
  display:block;
  width:100%;
  margin:10px auto;
}

button {
  padding:12px;
  margin:5px;
  font-size:28px;
  cursor:pointer;
  width:70px;
  height:60px;
}
</style>
</head>

<body>

<h1>üèÉ Mikhail Play</h1>

<canvas id="game" width="600" height="200"></canvas>

<p>
Points: <span id="score">0</span> |
Best Score: <span id="best">0</span> |
Health: <span id="lives">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</span> |
Passed: <span id="round">0</span>/24 |
Mood: <span id="mood">Day</span>
</p>

<div>
<button onclick="doAction('jump')">‚¨ÜÔ∏è</button>
<button onclick="doAction('flip')">üîÑ</button>
<button onclick="doAction('hit')">üëä</button>
<button onclick="doAction('kick')">ü¶µ</button>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<button id="pauseBtn" onclick="togglePause()">‚è∏Ô∏è</button>
</div>

<script>

/* ================= CONSTANTS ================= */

const GROUND_Y = 160;

const ROUND_SIZE = 24;
const NIGHT_START = 7;
const SUNRISE_START = 16;
const DAY_RESET = 20;

const GAME_SPEED = 1.4;
const SPAWN_RATE = 0.015;

const PLAYER_H = 60;
const PLAYER_W = 40;

const ANIM_TIME = 100;

const MAX_DARK = 0.9;

const NIGHT_COLOR = '15, 25, 60';


/* ================= CANVAS ================= */

const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");


/* ================= DATA ================= */

let score = 0;
let best = Number(localStorage.getItem("bestScore")) || 0;

let lives = 3;
let round = 0;

let obstacle = null;
let canAct = false;
let lastAction = null;

let paused = false;

let flashTime = 0;
const FLASH_DURATION = 10; 

let darkness = 0;
let stars = [];

let groundOffset = 0;


// GROUND

const groundTexture = [];

for(let i = 0; i < 150; i++){
  groundTexture.push({
    x: Math.random() * canvas.width,
    y: GROUND_Y + Math.random() * 40,
    w: Math.random() * 4 + 1,
    h: Math.random() * 4 + 1,
    color: "rgba(0,0,0,0.2)"
  });
}

// Optional stripes (also permanent)
const groundStripes = [];
for(let y = GROUND_Y; y < GROUND_Y + 40; y += 4){
  groundStripes.push({
    y: y,
    color: `rgba(0,0,0,${Math.random() * 0.05})`
  });
}


/* ================= STARS ================= */

for(let i=0;i<40;i++){
  stars.push({
    x:Math.random()*canvas.width,
    y:Math.random()*(GROUND_Y-20),
    r:Math.random()*1.5+0.5
  });
}


/* ================= PLAYER ================= */


const player = {

  x:120,

  baseY:GROUND_Y-PLAYER_H,
  y:GROUND_Y-PLAYER_H,

  w:PLAYER_W,
  h:PLAYER_H,

  action:"run",
  anim:0,
  rot:0
};


/* ================= OBSTACLES ================= */

const obstacles = [
  {type:"lava",action:"flip",points:4},
  {type:"gap",action:"jump",points:2},
  {type:"cactus",action:"hit",points:2},
  {type:"wall",action:"kick",points:3}
];


/* ================= UI ================= */

function updateUI(){

  document.getElementById("score").textContent = score;
  document.getElementById("best").textContent = best;
  document.getElementById("lives").textContent = "‚ù§Ô∏è".repeat(lives);
  document.getElementById("round").textContent = round;

  let mood="Day";

  if(round>=NIGHT_START && round<SUNRISE_START) mood="Night";
  else if(round>=SUNRISE_START && round<DAY_RESET) mood="Sunrise";

  document.getElementById("mood").textContent = mood;
}


/* ================= PAUSE ================= */

function togglePause(){

  paused=!paused;

  document.getElementById("pauseBtn").textContent =
    paused?"‚ñ∂Ô∏è":"‚è∏Ô∏è";

  if(!paused) update();
}


/* ================= SPAWN ================= */

function spawnObstacle(){

  const o = obstacles[Math.floor(Math.random()*obstacles.length)];

  obstacle={
    x:canvas.width,
    y:GROUND_Y-40,
    w:40,
    h:40,

    type:o.type,
    action:o.action,
    points:o.points
  };

  canAct=true;
  lastAction=null;
}


/* ================= INPUT ================= */

function doAction(a){

  if(!canAct) return;

  lastAction=a;

  player.action=a;
  player.anim=ANIM_TIME;

  if(a==="flip") player.rot=0;
}


/* ================= SUCCESS ================= */

function success(){

  if(!obstacle) return;

  score+=obstacle.points;
  round++;

  if(score>best){
    best=score;
    localStorage.setItem("bestScore",best);
  }

  // Only remove cactus & wall
  if(obstacle.type!=="gap" && obstacle.type!=="lava"){
    obstacle=null;
  }

  canAct=false;

  if(round>=ROUND_SIZE) round=0;
}


/* ================= FAIL ================= */

function fail(){

  if(!obstacle) return;

  lives--;

  flashTime = FLASH_DURATION;

  obstacle=null;
  canAct=false;

  player.action="run";
  player.rot=0;

  if(lives<=0){

    alert("Game Over: "+score);

    score=0;
    lives=3;
    round=0;
  }
}


/* ================= NIGHT SYSTEM ================= */

function updateDarkness(){

  if(round>=NIGHT_START && round<SUNRISE_START){

    darkness+=0.005;
    if(darkness>MAX_DARK) darkness=MAX_DARK;
  }

  else if(round>=SUNRISE_START && round<DAY_RESET){

    darkness-=0.005;
    if(darkness<0) darkness=0;
  }

  else{

    darkness=0;
  }
}


/* ================= BACKGROUND ================= */

function drawStars(){

  if(darkness<0.2) return;

  ctx.fillStyle=`rgba(224, 224, 224, ${darkness}`;

  for(let s of stars){

    ctx.beginPath();
    ctx.arc(s.x,s.y,s.r,0,Math.PI*2);
    ctx.fill();
  }
}

function drawMoon() {
  if(darkness < 0.2) return; // Only show moon at night

  const moonX = canvas.width - 80; // Position from the right
  const moonY = 60;                // Position from the top
  const moonRadius = 22;

  // Moon body
  ctx.beginPath();
  ctx.arc(moonX, moonY, moonRadius, 0, Math.PI * 2);
  ctx.fillStyle = `rgba(255, 255, 210, ${darkness})`; // Fades in with night
  ctx.fill();
}

function drawSun() {
  if(darkness > 0.2) return; // Only show sun during day

  const sunX = 0;   // Left side
  const sunY = 0;   // Top
  const sunRadius = 40;

  // Sun body
  ctx.beginPath();
  ctx.arc(sunX, sunY, sunRadius, 0, Math.PI * 2);
  ctx.fillStyle = `rgba(255, 220, 0, ${1 - darkness})`; // Fades out as night comes
  ctx.fill();

  const numRays = 40;       // More rays
  const innerRadius = sunRadius + 2;  // Closer to sun
  const outerRadius = sunRadius + 30; // Shorter rays

  for(let i = 0; i < numRays; i++){
    const angle = (Math.PI * 2 / numRays) * i;
    const x1 = sunX + Math.cos(angle) * innerRadius;
    const y1 = sunY + Math.sin(angle) * innerRadius;
    const x2 = sunX + Math.cos(angle) * outerRadius;
    const y2 = sunY + Math.sin(angle) * outerRadius;
    ctx.strokeStyle = `rgba(255, 220, 0, ${1 - darkness})`;
    ctx.lineWidth = 0.25; // Thinner rays
    ctx.beginPath();
    ctx.moveTo(x1, y1);
    ctx.lineTo(x2, y2);
    ctx.stroke();
  }
}

function drawGround() {
  ctx.fillStyle = "#654321";
  ctx.fillRect(0, GROUND_Y, canvas.width, 40);

  // Draw permanent texture spots with offset
  for (let spot of groundTexture){
    let x = (spot.x + groundOffset) % canvas.width;
    if (x < 0) x += canvas.width; // wrap around
    ctx.fillStyle = spot.color;
    ctx.fillRect(x, spot.y, spot.w, spot.h);
  }

  // Draw stripes with offset
  for (let stripe of groundStripes){
    let y = stripe.y;
    ctx.fillStyle = stripe.color;
    ctx.fillRect(0, y, canvas.width, 2);
  }
}


function drawBackground(){

  // Day base
  ctx.fillStyle="#f2d16b";
  ctx.fillRect(0,0,canvas.width,canvas.height);


  // Night overlay
  if(darkness>0){

    ctx.fillStyle=`rgba(${NIGHT_COLOR},${darkness})`;
    ctx.fillRect(0,0,canvas.width,canvas.height);
  }

  //if(flashTime > 0){
  //  ctx.fillStyle = `rgba(255,0,0,0.4)`; // semi-transparent red
  //  ctx.fillRect(0, 0, canvas.width, canvas.height);
  //  flashTime--;
  //}

  drawSun();

  drawStars();

  drawMoon();

  drawGround();
}


/* ================= ANIM ================= */

function updateAnim(){

  if(player.anim>0){

    player.anim--;

    if(player.action==="jump")
      player.y=player.baseY-40;

    if(player.action==="flip"){

      player.y=player.baseY-55;
      player.rot+=Math.PI/20;
    }

  }else{

    player.y=player.baseY;
    player.action="run";
    player.rot=0;
  }
}


/* ================= PLAYER DRAW ================= */

function drawPlayer(){

  updateAnim();

  ctx.save();

  ctx.translate(player.x+20,player.y+30);
  ctx.rotate(player.rot);
  ctx.translate(-20,-30);

  ctx.fillStyle="#ffe0bd";
  ctx.fillRect(10,0,20,20);

  ctx.fillStyle="brown";
  ctx.fillRect(0,20,40,40);

  ctx.fillStyle="darkblue";
  ctx.fillRect(-10,25,10,25);

  ctx.fillStyle="black";
  ctx.fillRect(5,-5,30,5);
  ctx.fillRect(12,-15,15,10);

  ctx.fillStyle="orange";

  if(player.action==="hit")
    ctx.fillRect(35,25,25,10);
  else
    ctx.fillRect(32,35,8,15);

  if(player.action==="kick"){
    ctx.fillStyle="#ffe0bd";
    ctx.fillRect(30,55,25,8);
  }

  ctx.restore();
}


/* ================= OBSTACLE DRAW ================= */

function drawObstacle(){

  if(!obstacle) return;


  // Lava
  if(obstacle.type==="lava"){

    ctx.fillStyle = "red";
    ctx.fillRect(obstacle.x, GROUND_Y, 80, 40); // same height as ground

    // Draw lava flames
    ctx.font = "24px Arial";
    ctx.fillText("üî•üî•üî•", obstacle.x + 2, GROUND_Y - 5);
    ctx.fillText("üî•üî•üî•", obstacle.x + 2, GROUND_Y + 10);
    ctx.fillText("üî•üî•üî•", obstacle.x + 2, GROUND_Y + 25);
    ctx.fillText("üî•üî•üî•", obstacle.x + 2, GROUND_Y + 40);

    // Optional: add slight glow around lava
    ctx.fillStyle = "rgba(255,100,0,0.3)";
    ctx.fillRect(obstacle.x, GROUND_Y, 80, 40);
  }


  // Cactus
  if(obstacle.type==="cactus"){

    ctx.font="50px Arial";
    ctx.fillText("üåµ",obstacle.x,GROUND_Y);
  }


  // Wall
  if(obstacle.type==="wall"){

    ctx.fillStyle="gray";
    ctx.fillRect(obstacle.x,GROUND_Y-70,40,70);

    ctx.fillStyle="darkgray";

    for(let i=0;i<5;i++){
      ctx.fillRect(
        obstacle.x,
        GROUND_Y-70+i*14,
        40,2
      );
    }
  }


  // Gap (same as background)
  if(obstacle.type==="gap"){

    ctx.fillStyle="#f2d16b";
    ctx.fillRect(obstacle.x,GROUND_Y,40,40);

    if(darkness>0){

      ctx.fillStyle=`rgba(15,25,60,${darkness})`;
      ctx.fillRect(obstacle.x,GROUND_Y,40,40);
    }
  }
}


/* ================= LOOP ================= */

function update(){

  if(paused) return;

  groundOffset -= GAME_SPEED;
    if (groundOffset < -canvas.width) groundOffset = 0;

  updateDarkness();

  drawBackground();
  drawPlayer();


  if(!obstacle && Math.random()<SPAWN_RATE){
    spawnObstacle();
  }


  if(obstacle){

    obstacle.x-=GAME_SPEED;


    if(
      obstacle.x<player.x+40 &&
      obstacle.x+40>player.x
    ){

      if(canAct){

        if(lastAction===obstacle.action)
          success();
        else
          fail();
      }
    }


    // Remove only when fully gone
    if(obstacle && obstacle.x+40<0){

      obstacle=null;
      canAct=false;
    }
  }


  drawObstacle();


  updateUI();

  requestAnimationFrame(update);
}


/* ================= START ================= */

update();

</script>
</body>
</html>
